<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.9.12">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>our-struggle</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-cdaacfc258cb6f151192107f105ac881.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0a61af393cc41664e89a7addda21b354.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     
      </head>

  <body class="quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> 1956-04-01_our-struggle.qmd</h6>

            <a href="../corpus_simple_qmd/1956-04-01_our-struggle.qmd" class="btn btn-primary quarto-download-embed" download="1956-04-01_our-struggle.qmd">Download Source</a>
          </div>

     <div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">    <p>Our Struggle</p>
<p>The segregation of Negroes, with its inevitable discrimination, has thrived on elements of inferiority present in the masses of both white and Negro people. Through forced separation from our African culture, through slavery, poverty, and deprivation, many black men lost self-respect.</p>
<p>In their relations with Negroes, white people discovered that they had rejected the very center of their own ethical professions. They could not face the triumph of their lesser instincts and simultaneously have peace within. And so, to gain it, they rationalized—insisting that the unfortunate Negro, being less than human, deserved and even enjoyed second-class status.</p>
<p>They argued that his inferior social, economic and political position was good for him. He was incapable of advancing beyond a fixed position and would therefore be happier if encouraged not to attempt the impossible. He is subjugated by a superior people with an advanced way of life. The “master race” will be able to civilize him to a limited degree, if only he will be true to his inferior nature and stay in his place.</p>
<p>White men soon came to forget that the southern social culture and all its institutions had been organized to perpetuate this rationalization. They observed a caste system and quickly were conditioned to believe that its social results, which they had created, actually reflected the Negro’s innate and true nature.</p>
<p>In time many Negroes lost faith in themselves and came to believe that perhaps they really were what they had been told they were—something less than men. So long as they were prepared to accept this role, racial peace could be maintained. It was an uneasy peace in which the Negro was forced to accept patiently injustice, insult, injury and exploitation.</p>
<p>Gradually the Negro masses in the South began to reevaluate themselves—a process that was to change the nature of the Negro community and doom the social patterns of the South. We discovered that we had never really smothered our self-respect and that we could not be at one with ourselves without asserting it. From this point on, the South’s terrible peace was rapidly undermined by the Negro’s new and courageous thinking and his ever-increasing readiness to organize and to act. Conflict and violence were coming to the surface as the white South desperately clung to its old patterns. The extreme tension in race relations in the South today is explained in part by the revolutionary change in the Negro’s evaluation of himself and of his destiny and by his determination to struggle for justice. We Negroes have replaced self-pity with self-respect and self-depreciation with dignity.</p>
<p>When Mrs.&nbsp;Rosa Parks, the quiet seamstress whose arrest precipitated the nonviolent protest in Montgomery, was asked why she had refused to move to the rear of a bus, she said: “It was a matter of dignity; I could not have faced myself and my people if I had moved.” THE NEW NEGRO</p>
<p>Many of the Negroes who joined the protest did not expect it to succeed. When asked why, they usually gave one of three answers: “I didn’t expect Negroes to stick to it,” or, “I never thought we Negroes had the nerve,” or, “I thought the pressure from the white folks would kill it before it got started.”</p>
<p>In other words, our nonviolent protest in Montgomery is important because it is demonstrating to the Negro, North and South, that many of the stereotypes he has held about himself and other Negroes are not valid. Montgomery has broken the spell and is ushering in concrete manifestations of the thinking and action of the new Negro.</p>
<p>We now know that:</p>
<p>We Can Stick Together</p>
<p>In Montgomery, forty-two thousand of us have refused to ride the city’s segregated buses since December 5. Some walk as many as fourteen miles a day.</p>
<p>Our Leaders Do Not Have to Sell Out</p>
<p>Many of us have been indicted, arrested, and “mugged.” Every Monday and Thursday night we stand before the Negro population at the prayer meetings and repeat: “It is an honor to face jail for a just cause.”</p>
<p>Threats and Violence Do Not Necessarily Intimidate Those Who Are Sufficiently Aroused and Nonviolent</p>
<p>The bombing of two of our homes has made us more resolute. When a handbill was circulated at a White Citizens Council meeting stating that Negroes should be “abolished” by “guns, bows and arrows, sling shots and knives,” we responded with even greater determination.</p>
<p>Our Church Is Becoming Militant</p>
<p>Twenty-four ministers were arrested in Montgomery. Each has said publicly that he stands prepared to be arrested again. Even upper-class Negroes who reject the “come to Jesus” gospel are now convinced that the church has no alternative but to provide the nonviolent dynamics for social change in the midst of conflict. The thirty thousand dollars used for the car pool, which transports over twenty thousand Negro workers, school children and housewives, has been raised in the churches. The churches have become the dispatch centers where the people gather to wait for rides.</p>
<p>We Believe in Ourselves</p>
<p>In Montgomery we walk in a new way. We hold our heads in a new way. Even the Negro reporters who converged on Montgomery have a new attitude. One tired reporter, asked at a luncheon in Birmingham to say a few words about Montgomery, stood up, thought for a moment, and uttered one sentence: “Montgomery has made me proud to be a Negro.”</p>
<p>Economics Is Part of Our Struggle</p>
<p>We are aware that Montgomery’s white businessmen have tried to “talk sense” to the bus company and the city commissioners. We have observed that small Negro shops are thriving as Negroes find it inconvenient to walk downtown to the white stores. We have been getting more polite treatment in the white shops since the protest began. We have a new respect for the proper use of our dollar.</p>
<p>We Have Discovered a New and Powerful Weapon—Nonviolent Resistance</p>
<p>Although law is an important factor in bringing about social change, there are certain conditions in which the very effort to adhere to new legal decisions creates tension and provokes violence. We had hoped to see demonstrated a method that would enable us to continue our struggle while coping with the violence it aroused. Now we see the answer: face violence if necessary, but refuse to return violence. If we respect those who oppose us, they may achieve a new understanding of the human relations involved.</p>
<p>We Now Know That the Southern Negro Has Come of Age, Politically and Morally</p>
<p>Montgomery has demonstrated that we will not run from the struggle, and will support the battle for equality. The attitude of many young Negroes a few years ago was reflected in the common expression, “I’d rather be a lamp post in Harlem than Governor of Alabama.” Now the idea expressed in our churches, schools, pool rooms, restaurants and homes is: “Brother, stay here and fight nonviolently. ’Cause if you don’t let them make you mad, you can win.” The official slogan of the Montgomery Improvement Association is “Justice without Violence.” THE ISSUES IN MONTGOMERY</p>
<p>The leaders of the old order in Montgomery are not prepared to negotiate a settlement. This is not because of the conditions we have set for returning to the buses. The basic question of segregation in intrastate travel is already before the courts. Meanwhile we ask only for what in Atlanta, Mobile, Charleston and most other cities of the South is considered the southern pattern. We seek the right, under segregation, to seat ourselves from the rear forward on a first come, first served basis. In addition, we ask for courtesy and the hiring of some Negro bus drivers on predominantly Negro routes.</p>
<p>A prominent judge of Tuscaloosa was asked if he felt there was any connection between Autherine Lucy’s effort to enter the University of Alabama and the Montgomery nonviolent protest. He replied, “Autherine is just one unfortunate girl who doesn’t know what she is doing, but in Montgomery it looks like all the niggers have gone crazy.”</p>
<p>Later the judge is reported to have explained that “of course the good niggers had undoubtedly been riled up by outsiders, Communists and agitators.” It is apparent that at this historic moment most of the elements of the white South are not prepared to believe that “our Negroes could of themselves act like this.” MISCALCULATION OF THE WHITE LEADERS</p>
<p>Because the mayor and city authorities cannot admit to themselves that we have changed, every move they have made has inadvertently increased the protest and united the Negro community.</p>
<p>[1955]</p>
<p>Dec.&nbsp;1 They arrested Mrs.&nbsp;Parks, one of the most respected Negro women in Montgomery.</p>
<p>Dec.&nbsp;3 They attempted to intimidate the Negro population by publishing a report in the daily paper that certain Negroes were calling for a boycott of the buses. They thereby informed the thirty thousand Negro readers of the planned protest.</p>
<p>Dec.&nbsp;5 They found Mrs.&nbsp;Parks guilty and fined her fourteen dollars. This action increased the number of those who joined the boycott.</p>
<p>Dec.&nbsp;5 They arrested a Negro college student for “intimidating passengers.” Actually, he was helping an elderly woman cross the street. This mistake solidified the college students’ support of the protest.</p>
<p>Two policemen on motorcycles followed each bus on its rounds through the Negro community. This attempt at psychological coercion further increased the number of Negroes who joined the protest.</p>
<p>In a news telecast at 6:00 P.M., a mass meeting planned for that evening was announced. Although we had expected only five hundred people at the meeting, over five thousand attended.</p>
<p>Dec.&nbsp;6 They began to intimidate Negro taxi drivers. This led to the setting up of a car pool and a resolution to extend indefinitely our protest, which had originally been called for one day only.</p>
<p>Dec.&nbsp;7 They began to harass Negro motorists. This encouraged the Negro middle class to join the struggle.</p>
<p>Dec.&nbsp;8 The lawyer for the bus company said, “We have no intention of hiring Negro drivers now or in the foreseeable future.” To us this meant never. The slogan then became, “Stay off the buses until we win.”</p>
<p>Dec.&nbsp;9 The mayor invited Negro leaders to a conference, presumably for negotiation. When we arrived, we discovered that some of the men in the room were white supremacists and members of the White Citizens Council. The mayor’s attitude was made clear when he said, “Comes the first rainy day and the Negroes will be back in the buses.” The next day it did rain, but the Negroes did not ride the buses.</p>
<p>At this point over forty-two thousand Montgomery Negroes had joined the protest. After a period of uneasy quiet, elements in the white community turned to further police intimidation and to violence.</p>
<p>[1956]</p>
<p>Jan.&nbsp;26 I was arrested for traveling thirty miles per hour in a twenty-five-mile zone. This arrest occurred just two hours before a mass meeting. So, we had to hold seven mass meetings to accommodate the people.</p>
<p>Jan.&nbsp;30 My home was bombed.</p>
<p>Feb.&nbsp;1 The home of E. D. Nixon, one of the protest leaders and former state president of the NAACP, was bombed. This brought moral and financial support from all over the state.</p>
<p>Feb.&nbsp;22 Eighty-nine persons, including the twenty-four ministers, were arrested for participating in the nonviolent protests.</p>
<p>Every attempt to end the protest by intimidation, by encouraging Negroes to inform, by force and violence, further cemented the Negro community and brought sympathy for our cause from men of good will all over the world. The great appeal for the world appears to lie in the fact that we in Montgomery have adopted the method of nonviolence. In a world in which most men attempt to defend their highest values by the accumulation of weapons of destruction, it is morally refreshing to hear five thousand Negroes in Montgomery shout “Amen” and “Halleluh” when they are exhorted to “pray for those who oppose you,” or pray “Oh Lord, give us strength of body to keep walking for freedom,” and conclude each mass meeting with: “Let us pray that God shall give us strength to remain nonviolent though we may face death.” THE LIBERAL DILEMMA</p>
<p>And death there may be. Many white men in the South see themselves as a fearful minority in an ocean of black men. They honestly believe with one side of their minds that Negroes are depraved and disease-ridden. They look upon any effort at equality as leading to “mongrelization.” They are convinced that racial equality is a Communist idea and that those who ask for it are subversive. They believe that their caste system is the highest form of social organization.</p>
<p>The enlightened white southerner, who for years has preached gradualism, now sees that even the slow approach finally has revolutionary implications. Placing straws on a camel’s back, no matter how slowly, is dangerous. This realization has immobilized the liberals and most of the white church leaders. They have no answer for dealing with or absorbing violence. They end in begging for retreat, lest “things get out of hand and lead to violence.”</p>
<p>Writing in Life, William Faulkner, Nobel Prize–winning author from Mississippi, recently urged the NAACP to “stop now for a moment.” That is to say, he encouraged Negroes to accept injustice, exploitation and indignity for a while longer. It is hardly a moral act to encourage others patiently to accept injustice which he himself does not endure.</p>
<p>In urging delay, which in this dynamic period is tantamount to retreat, Faulkner suggests that those of us who press for change now may not know that violence could break out. He says we are “dealing with a fact: the fact of emotional conditions of such fierce unanimity as to scorn the fact that it is a minority and which will go to any length and against any odds at this moment to justify and, if necessary, defend that condition and its right to it.”</p>
<p>We southern Negroes believe that it is essential to defend the right of equality now. From this position we will not and cannot retreat. Fortunately, we are increasingly aware that we must not try to defend our position by methods that contradict the aim of brotherhood. We in Montgomery believe that the only way to press on is by adopting the philosophy and practice of nonviolent resistance.</p>
<p>This method permits a struggle to go on with dignity and without the need to retreat. It is a method that can absorb the violence that is inevitable in social change whenever deep-seated prejudices are challenged.</p>
<p>If, in pressing for justice and equality in Montgomery, we discover that those who reject equality are prepared to use violence, we must not despair, retreat, or fear. Before they make this crucial decision, they must remember: whatever they do, we will not use violence in return. We hope we can act in the struggle in such a way that they will see the error of their approach and will come to respect us. Then we can all live together in peace and equality.</p>
<p>The basic conflict is not really over the buses. Yet we believe that, if the method we use in dealing with equality in the buses can eliminate injustice within ourselves, we shall at the same time be attacking the basis of injustice—man’s hostility to man. This can only be done when we challenge the white community to re-examine its assumptions as we are now prepared to reexamine ours.</p>
<p>We do not wish to triumph over the white community. That would only result in transferring those now on the bottom to the top. But, if we can live up to nonviolence in thought and deed, there will emerge an interracial society based on freedom for all.</p>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>  </div> <!-- /content --> 
  
</body></html>